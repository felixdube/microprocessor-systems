


ARM Macro Assembler    Page 1 


    1 00000000                 AREA             kalmanfilter_asm, CODE, READONL
Y
    2 00000000                 EXPORT           kalmanfilter
    3 00000000         kalmanfilter
    4 00000000         ;R0 pointer to input array
    5 00000000         ;R1 pointer to filtered data
    6 00000000         ;R2 array's length
    7 00000000         ;R3 pointer to kalmen filter state
    8 00000000         
    9 00000000 F04F 0400       MOV              R4, #0      ;data addr offset
   10 00000004         
   11 00000004         ;load data
   12 00000004 EDD0 0A00       VLDR.f32         S1, [R0]    ;measurement
   13 00000008 ED93 1A08       VLDR.f32         S2, [R3, #32] 
                                                            ;noise covariance q
                                                            
   14 0000000C EDD3 1A10       VLDR.f32         S3, [R3, #64] 
                                                            ;estimated value x
   15 00000010 ED93 2A18       VLDR.f32         S4, [R3, #96] ;estimation error
                                                             covariance p
   16 00000014 EDD3 2A20       VLDR.f32         S5, [R3, #128] ;adaptive kalman
                                                             filter k
   17 00000018         
   18 00000018         
   19 00000018         ;P = P + Q
   20 00000018 EE32 2A01       VADD.f32         S4, S4, S2
   21 0000001C         
   22 0000001C         ;k = p/ (p + q)
   23 0000001C EE32 3A01       VADD.f32         S6, S4, S2
   24 00000020 EEC2 2A03       VDIV.f32         S5, S4, S6
   25 00000024         
   26 00000024         ;x = x + k * (measurement - x)
   27 00000024 EE30 3AE1       VSUB.f32         S6, S1, S3
   28 00000028 EE23 3A22       VMUL.f32         S6, S6, S5
   29 0000002C EE71 1A83       VADD.f32         S3, S3, S6
   30 00000030         
   31 00000030         ;p = (1 - k) * p
   32 00000030 EEF7 3A00       VLDR.f32         S7, =1.0
   33 00000034 EE33 3AE2       VSUB.f32         S6, S7, S5
   34 00000038 EE22 2A03       VMUL.f32         S4, S4, S6
   35 0000003C         
   36 0000003C         ;store the output
   37 0000003C 4421            ADD              R1, R1, R4
   38 0000003E EDC1 1A00       VSTR.f32         S3, [R1]
   39 00000042         
   40 00000042         ;update array pointer
   41 00000042 F100 0020       ADD              R0, R0, #32
   42 00000046 F101 0120       ADD              R1, R1, #32
   43 0000004A         
   44 0000004A         ;update the loop counter
   45 0000004A F104 0401       ADD              R4, R4, #1
   46 0000004E         
   47 0000004E         ;check if all the data have been filtered
   48 0000004E 42A2            CMP              R2, R4
   49 00000050 D1FE            BNE              kalmanfilter
   50 00000052         
   51 00000052                 END
Command Line: --debug --xref --diag_suppress=9931 --cpu=Cortex-M4.fp --apcs=int
erwork --depend=.\objects\kalmanfilter_asm.d -o.\objects\kalmanfilter_asm.o -I\



ARM Macro Assembler    Page 2 


\psf\Home\Documents\workspace\ecse426\git\Lab1_STM32F4Cube_Base_project\RTE -IC
:\Keil_v5\ARM\PACK\ARM\CMSIS\4.5.0\CMSIS\Include -IC:\Keil_v5\ARM\PACK\Keil\STM
32F4xx_DFP\2.7.0\Drivers\CMSIS\Device\ST\STM32F4xx\Include --predefine="__EVAL 
SETA 1" --predefine="__UVISION_VERSION SETA 517" --predefine="_RTE_ SETA 1" --p
redefine="STM32F407xx SETA 1" --list=.\listings\kalmanfilter_asm.lst kalmanfilt
er_asm.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

kalmanfilter 00000000

Symbol: kalmanfilter
   Definitions
      At line 3 in file kalmanfilter_asm.s
   Uses
      At line 2 in file kalmanfilter_asm.s
      At line 49 in file kalmanfilter_asm.s

kalmanfilter_asm 00000000

Symbol: kalmanfilter_asm
   Definitions
      At line 1 in file kalmanfilter_asm.s
   Uses
      None
Comment: kalmanfilter_asm unused
2 symbols
337 symbols in table
