


ARM Macro Assembler    Page 1 


    1 00000000         
    2 00000000                 AREA             text, CODE, READONLY
    3 00000000                 EXPORT           kalmanFilter_asm
    4 00000000         kalmanFilter_asm
    5 00000000         ;R0 pointer to input array
    6 00000000         ;R1 pointer to filtered data
    7 00000000         ;R2 array's length
    8 00000000         ;R3 pointer to kalmen filter state
    9 00000000         
   10 00000000         ;load filter state data
   11 00000000 ECD3 0A05       VLDM             R3, {S1-S5}
   12 00000004         
   13 00000004         loop
   14 00000004 ED90 0A00       VLDR.f32         S0, [R0]    ;measurement/ initi
                                                            al value
   15 00000008         
   16 00000008         ;P = P + Q
   17 00000008 EE32 2A20       VADD.f32         S4, S4, S1
   18 0000000C         ; maybe can optimise
   19 0000000C         ;also check if we have to use updated p or initial p
   20 0000000C         ;k = p/ (p + r)
   21 0000000C EE32 3A01       VADD.f32         S6, S4, S2
   22 00000010 EEC2 2A03       VDIV.f32         S5, S4, S6
   23 00000014         ;x = x + k * (measurement - x)
   24 00000014 EE30 3A61       VSUB.f32         S6, S0, S3
   25 00000018 EE23 3A22       VMUL.f32         S6, S6, S5
   26 0000001C EE71 1A83       VADD.f32         S3, S3, S6  ;simplyfied these t
                                                            wo with one command
                                                              
   27 00000020         ;p = (1 - k) * p = p-pk
   28 00000020 EE22 3A22       VMUL.f32         S6, S4, S5
   29 00000024 EE32 2A43       VSUB.f32         S4, S4, S6
   30 00000028         ;store the output
   31 00000028 EDC1 1A00       VSTR.f32         S3, [R1]
   32 0000002C F101 0104       ADD              R1, R1, #4
   33 00000030 F100 0004       ADD              R0, R0, #4
   34 00000034         ;update counter
   35 00000034 3A01            SUBS             R2, #1
   36 00000036         ;Branch if R2 != 0 
   37 00000036 D1E5            BNE              loop
   38 00000038         ;verify overflow
   39 00000038 EEF1 0A10       VMRS             R0, FPSCR   ; Copy flags from F
                                                            PSCR to flags in AP
                                                            SR
   40 0000003C         ;This is the return value of the function : 
   41 0000003C         ; 0 or 10 is a good result
   42 0000003C         ; 15 or 11 means there has been an error, don't trust th
                       e output array
   43 0000003C         
   44 0000003C         ;;check for most common  0x00000010
   45 0000003C         ;SUB R1, #0x00000010
   46 0000003C         ;CBZ R1, exit   ;if no error this will be zero
   47 0000003C         ;;check for second most common 0x00000000
   48 0000003C         ;ADD R1, #0x00000010
   49 0000003C         ;CBZ R1, exit   ;if no error this will be zero
   50 0000003C         ;;if not 0x00000010 or 0x00000000 error code
   51 0000003C         ;MOV R0, #1
   52 0000003C 4770    exit    BX               LR
   53 0000003E                 END



ARM Macro Assembler    Page 2 


Command Line: --debug --xref --diag_suppress=9931 --cpu=Cortex-M4.fp --apcs=int
erwork --depend=.\objects\kalmanfilter_asm.d -o.\objects\kalmanfilter_asm.o -IC
:\Users\juan-\Documents\University\University6\MicroP\Lab_1_team\microprocessor
-systems\Lab1_STM32F4Cube_Base_project\RTE -IC:\Keil_v5\ARM\PACK\ARM\CMSIS\4.5.
0\CMSIS\Include -IC:\Keil_v5\ARM\PACK\Keil\STM32F4xx_DFP\2.7.0\Drivers\CMSIS\De
vice\ST\STM32F4xx\Include --predefine="__EVAL SETA 1" --predefine="__UVISION_VE
RSION SETA 517" --predefine="_RTE_ SETA 1" --predefine="STM32F407xx SETA 1" --l
ist=.\listings\kalmanfilter_asm.lst kalmanfilter_asm.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

exit 0000003C

Symbol: exit
   Definitions
      At line 52 in file kalmanfilter_asm.s
   Uses
      None
Comment: exit unused
kalmanFilter_asm 00000000

Symbol: kalmanFilter_asm
   Definitions
      At line 4 in file kalmanfilter_asm.s
   Uses
      At line 3 in file kalmanfilter_asm.s
Comment: kalmanFilter_asm used once
loop 00000004

Symbol: loop
   Definitions
      At line 13 in file kalmanfilter_asm.s
   Uses
      At line 37 in file kalmanfilter_asm.s
Comment: loop used once
text 00000000

Symbol: text
   Definitions
      At line 2 in file kalmanfilter_asm.s
   Uses
      None
Comment: text unused
4 symbols
339 symbols in table
